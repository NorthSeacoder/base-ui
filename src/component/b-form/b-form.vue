<!-- @author yanglan -->
<!-- @email yanglan@yangqianguan.com -->
<!-- @date 2018-04-16 14:57:22.524 -->
<!-- @desc generated by yqg-cli@0.1.0-beta.8 -->

<template>

    <form class="b-form" @submit.prevent="emitEvent('submit')">
        <slot
            v-for="fieldDef in options.fieldDefs"
            :name="fieldDef.field"
            :fieldDef="fieldDef">
            <b-form-group :label="fieldDef.label">
                <component
                    :value="data[fieldDef.field]"
                    :is="is(fieldDef.type)"
                    v-bind="fieldDef.props"
                    @input="emitChange(arguments, fieldDef)"
                    @change="emitChange(arguments, fieldDef)"/>
            </b-form-group>
        </slot>

        <div v-if="hasBtns" class="btn-group">
            <button
                v-for="btnDef in options.btnDefs"
                :key="btnKey(btnDef)"
                v-bind="btnDef.props"
                :type="btnType(btnDef.props)"
                @click="emitEvent(btnDef.event)">{{ btnDef.text }}</button>
        </div>
    </form>

</template>

<script type="text/babel">

    import {FieldMap} from './constant/field';

    export default {
        name: 'BForm',

        model: {
            prop: 'data',
            event: 'change'
        },

        props: {
            data: {
                type: Object,
                required: true
            },

            options: {
                type: Object,
                default: () => {}
            }
        },

        computed: {
            hasBtns() {
                const vm = this;

                return vm.options.btnDefs && vm.options.btnDefs.length > 0;
            }
        },

        methods: {
            is(type) {
                return FieldMap[type] || FieldMap.text;
            },

            btnType(props = {}) {
                return props.type || 'button';
            },

            btnKey({text, event}) {
                return text + event;
            },

            emitChange(data, {field}) {
                this.$emit('change', {
                    ...this.data,
                    [field]: data[0]
                });
            },

            emitEvent(event) {
                this.$emit(event);
            }
        }
    };

</script>
